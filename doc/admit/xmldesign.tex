%$Id$
\documentclass{report}
\title{ADMIT XML Design}
\author{Marc Pound, Peter Teuben}
\date{\today}
\begin{document}
\maketitle

\section{Overview}

ADMIT runs a series of ``admit tasks'', which are essentially beefed up
CASA tools/tasks. ADMIT provides a wrapper around them (much like
each CASA task has a {\tt foobar.xml} and {\tt task\_foobar.py} 
file) but with 
some extra baggage to make it fit within the pipeline and have a
persistent state (within the pipeline as well for re-use by the user
later on).

Users will be able to re-run selected portions of the ADMIT pipeline
from either the (casapy) commandline, or a (casa) GUI, and compare
and improve upon the pipeline produced results. ADMIT produces
Basic Data Product (BDP), in addition to the Alma Data Products
(ADP), such as the Raw Visibility Data and the Science Data Cubes.

Meta-projects can be defined, and ADMIT be used to steer and control
how to run on individual projects and sources, after which selected
results can be datamined 



\section{Guiding Principles}
The XML structure should be complete enough to capture proposed use cases,
but not so restrictive that it precludes future use cases. To that end, a
limited hierarchy is desirable, with basic ``objects" that can be contained
within one another but are not {\it defined} within one another.  However, we
do need to follow what we understand to be the basic hierarchical structure
of the archive produces Project$\rightarrow$Source$\rightarrow$Bands.
We argue it is not necessary to expose the Project container to
the user, e.g. in the case of a data mining operation that spans multiple
projects. The science is in the sources not the project. To that end, the
Project container is extremely thin: it contains only the identificiation
code, everything else is inside source containers.

\subsection{Elements vs. Attributes}.  
We follow the principal that data go in elements and metadata about
elements go in attributes.   Thus rather than

\begin{verbatim}
<project name="c0123">  
\end{verbatim}

we use 

\begin{verbatim}
<project>
<name>c0123</name>
\end{verbatim}

However, project name is an example of element we may want to be read-only
(ADMIT user cannot change it), so there we use an attribute.

\begin{verbatim}
<project>
  <name readonly="true">c0123</name>
\end{verbatim}

\subsection{Detailed Structure}
\begin{verbatim}
project
    source
        band
        line 
        image
        spectrum
        task
        procedure
    


<Project>
<source>
    <name></name>
    <coordinate>
        <crvalN>
        <ctypeN>
    </coordinate>
    <equinox></equinox>
    <type> [galactic, extragalactic, etc]
</source>

<image>
   <name>
   <type> [data or thumbnail]
   <description> [moment zero, moment one, spectral cutout, full cube. ??] 
% sources in this image
   <source>A</source> % must match source names in <source> tags.
   <naxisN>
   <crpixN>
   <crvalN>
   <ctypeN>
   <statistics>
%% Can have multiple areas over which statistics are measured.
%% NB: Does casa multiple boxes print two stats or one?
        <region>
            <number>
            <blc>
            <trc>
            <startchannel>
            <endchannel>
            <mean>
            <max>
            <rms>
            <clip>
        </region>
   </statistics>
</image>
<spectrum>
   <sourcename>
   <start freq>
   <start vel>
   <statistics> </statistics> %% as above
   <channel>value</channel>
   <channel>value</channel>
   <channel>value</channel>
   <channel>value</channel> 
  %% or better as a table?
</spectrum>

%% Just rely on CASA for this. Note TASK.last files are keyword=value, not XML!
<task>
  <name>
  <parameters>
    <keyword>value</keyword>
    <keyword2>value2</keyword2>
    ...etc
  </parameters>
  <date> date/time of last run? </date>
</task>
\end{verbatim}

\end{document}
