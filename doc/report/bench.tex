\documentclass{article}
\title{BENCHMARK}
\author{Peter Teuben}
\date{\today}
\begin{document}
\maketitle

% \section*{Benchmark}

A modest benchmark was devised to gain some insight in different
I/O patterns for a few packages accessible to us: CASA,
MIRIAD and NEMO. CASA uses a tiled storage manager, which in principle
can be tuned. MIRIAD has a traditional row based access, but rarely
uses memory to store full planes or cubes. NEMO is completely
memory based, but also stores the data row based (and by default
in double precision).
Three datasets of 4GB ($10^9$ pixels) in size were used:
a 1024x1024x1024 true data ``cube'',
a 4096x4096x64 ``slab'' and a 128x128x65536 ``stick''.
Four operations were considered:  reading from fits,
a simple rms/mean statistics that visits the whole cube in the
most efficient way, adding two cubes, and finally
a Hanning smooth in X, Y and Z, where possible.  For MIRIAD
the Hanning smooth test had to be skipped in X and Y, unless
an additional {\tt reorder} step would be allowed, which we did
not consider in this version of the benchmark.
It should be added that a true Hanning in MIRIAD
is the slowest possible operation, since the data is stored
row-wise.

\begin{table}[h]
\begin{center}
\begin{tabular}{|l || r r r || r r r || r r r |}
\hline
        & \multicolumn{3}{|c|}  { Cube } 
        &  \multicolumn{3}{|c|} { Slab }
        &  \multicolumn{3}{|c|} { Stick } \\
        & \multicolumn{3}{|c|}  { 1024x1024x1024 }
        &  \multicolumn{3}{|c|} { 4096x4096x64 } 
        &  \multicolumn{3}{|c|} { 128x128x65536 } \\
%        & CASA  & MIRIAD & NEMO    & CASA  & MIRIAD & NEMO  & CASA & MIRIAD & NEMO \\
        & C     & M    & N         & C     & M     & N      & C    & M    & N \\
\hline
FITS    & 16.6 & 13.5  &  17.2  & 13.7    & 11.5   & 17.9  & 25.2  &  14.7  & 20.0 \\
STATS   &      & 11.3  &  11.9  &         & 11.1   & 12.9  &       &  11.1  & 14.0 \\
MATH    &      &  7.7  &  36.8  &         & 7.8    &       &       &  8.6   &      \\
HAN-x   & 8.8  &       &  12.9  &  6.0    &        & 13.5  & 27.2  &        & 13.1 \\
HAN-y   & 9.8  &       &  23.8  &  8.7    &        & 48.5  & 28.6  &        & 14.2 \\
HAN-z   & 14.6 &  93.0 & 106.5  & 52.9    & 100.0  & 43.6  &  9.0  &  130.0 & 62.5 \\
\hline 
\end{tabular}
\end{center}
\caption{Comparing I/O access in a ``cube'', ``slab'' and ``stick'' like dataset. 
Times reported
are the sum of user and system time, in seconds, on a 3.6GHz i7-3820 CPU.
Columns designated are for C=CASA  M=MIRIAD N=NEMO(double) -- need to change NEMO to float!}
\end{table}



Not too surprisingly, the tiled access in CASA does surprisingly well for true
cubes, independant of the access direction.
But does poorly in a slab like cube, but outperforms anything else
for a stick like cube.

\newpage
and here is the old table we used to have, which will disappear in the final version

\begin{table}[h]
\begin{center}
\begin{tabular}{|l || r r r || r r r || r r r |}
\hline
        & \multicolumn{3}{|c|}  { VLA } 
        &  \multicolumn{3}{|c|} { CARMA }
        &  \multicolumn{3}{|c|} { NEMO } \\
        & \multicolumn{3}{|c|}  { 96x96x24012 } 
        &  \multicolumn{3}{|c|} { 1500x1500x150 }
        &  \multicolumn{3}{|c|} {  512x515x512 } \\
%        & CASA  & MIRIAD & NEMO    & CASA  & MIRIAD & NEMO  & CASA & MIRIAD & NEMO \\
        & C     & M    & N         & C     & M     & N      & C    & M    & N \\
\hline
FITS    &  4.6  & 3.1  &  4.3      &  4.4  & 3.7   & 5.6    & 1.8  & 1.5  & 2.3 \\
STATS   &  3.5  & 2.6  &  2.5      &  2.7  & 3.4   & 3.8    & ?    & 1.4  & 1.4 \\
HAN-x   &  7.6  & -    &  2.6      &  2.7  & -     & 4.1    & 1.3  & -    & 1.5 \\
HAN-y   &  8.1  & -    &  2.8      &  3.1  & -     & 5.2    & 1.5  & -    & 2.5 \\
HAN-z   &  1.8  & 9.1  & 10.3      &  8.8  & 26.0  & 5.7    & 1.8  & 9.5  & 8.9 \\
\hline 
\end{tabular}
\end{center}
\caption{Comparing I/O access in a ``stick'', ``slab'' and ``cube'' like dataset. 
Times reported
are the sum of user and system time, in seconds.   C=CASA  M=MIRIAD N=NEMO(double).
This table will disappear, replaced by the new table.}
\end{table}


\end{document}

